# Configuration

KSail-Go keeps cluster behavior reproducible by funnelling every option through a small set of well-defined configuration surfaces. Run `ksail cluster init` once, commit the generated files, and every team member can rely on the same defaults whether they prefer CLI flags or declarative YAML.

## Configuration surfaces

- [CLI options](cli-options.md) – Override configuration at runtime when you need a one-off change or want to experiment without editing YAML files.
- [Declarative config](declarative-config.md) – Capture long-lived settings inside `ksail.yaml`, `kind.yaml`, and `k3d.yaml` so the entire team shares the same environment.
- GitOps and workloads – The generated `k8s/` directory and Flux-ready layout remain declarative; see [project structure](../overview/project-structure.md) for the repo layout and the [use-case guides](../use-cases/index.md) for practical workflows.

## Precedence and loading

KSail-Go uses Viper under the hood to merge configuration. The effective value for every field is resolved in the following order (highest precedence first):

1. CLI flags supplied on the command being executed
2. Environment variables prefixed with `KSAIL_` (for example `KSAIL_SPEC_DISTRIBUTION=K3d`)
3. The nearest `ksail.yaml` located in the current directory, any parent directory, `~/.ksail/`, or `/etc/ksail/`
4. Built-in defaults compiled into the CLI

Because the config manager caches values per command invocation, changes made in one place (for example exporting an environment variable) immediately affect every subsequent `ksail cluster` subcommand in the same shell.

## Common defaults

| Setting                      | Default               | Where it comes from                    | Notes                                                                |
|------------------------------|-----------------------|----------------------------------------|----------------------------------------------------------------------|
| `spec.distribution`          | `Kind`                | Generated by `ksail cluster init`      | Switch to `K3d` when you prefer the K3s-based runtime.               |
| `spec.distributionConfig`    | `kind.yaml`           | Generated alongside `ksail.yaml`       | Update this path to point at an alternative Kind or K3d config file. |
| `spec.sourceDirectory`       | `k8s`                 | Project scaffolding                    | Flux and workload commands read manifests from this directory.       |
| `spec.connection.kubeconfig` | `~/.kube/config`      | Config manager defaults                | Override when you keep kubeconfigs elsewhere or run in CI.           |
| `spec.connection.context`    | set by the scaffolder | Derived from the selected distribution | Kind defaults to `kind-<project>`, K3d sets `k3d-<project>`.         |
| `spec.cni`                   | `Default`             | Stored in `ksail.yaml`                 | Choose `Cilium` or `Calico` for advanced networking during init.     |
| `spec.metricsServer`         | `Enabled`             | Stored in `ksail.yaml`                 | Use `Disabled` when you provide your own metrics pipeline.           |
| `spec.gitOpsEngine`          | `None`                | Stored in `ksail.yaml`                 | Reserved for future GitOps integrations.                             |

## When to edit what

- **Use CLI flags** for temporary overrides (`ksail cluster create --metrics-server Disabled`) or while iterating locally.
- **Edit `ksail.yaml`** when you want the new value to be the project-wide default—`ksail cluster create`, `start`, `stop`, and `delete` will all pick it up automatically.
- **Edit `kind.yaml` or `k3d.yaml`** to change node counts, ports, or other distribution-native settings that are not exposed as first-class KSail-Go flags.
- **Update `.sops.yaml`** (when generated) if you enable the SOPS secret manager and need to rotate Age recipients.

With these building blocks in place you can mix configuration styles confidently: long-term values live in version-controlled YAML, while flags and environment variables keep experimentation safe and reversible.
